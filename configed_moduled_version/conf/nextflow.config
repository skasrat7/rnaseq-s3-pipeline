// Main Nextflow configuration file
// Updated for ERCC spike-in analysis with nf-core/rnaseq

// Include additional configuration files
includeConfig 'conf/base.config'
includeConfig 'conf/resources.config'
includeConfig 'conf/rnaseq.config'

// Global parameters
params {
    // Input/Output
    input                     = 'samplesheet.csv'  // Update with your CSV file
    outdir                    = 's3://your-bucket/results'  // Update with your S3 path
    
    // Reference genome configuration
    genome                    = null  // We'll use custom references
    fasta                     = "${params.ref_dir}/GRCh38_ERCC_combined.fa"
    gtf                       = "${params.ref_dir}/GRCh38_ERCC_combined.gtf"
    
    // Reference paths
    ref_dir                   = './references'
    s3_genome_dir             = 's3://your-bucket/references/'  // Update with your S3 path
    
    // Reference file names
    genome_fasta              = 'Homo_sapiens.GRCh38.dna.primary_assembly.fa'
    genome_gtf                = 'Homo_sapiens.GRCh38.110.gtf'
    ercc_fasta                = 'ERCC92.fa'
    ercc_gtf                  = 'ERCC_biotypes.gtf'
    combined_fasta            = 'GRCh38_ERCC_combined.fa'
    combined_gtf              = 'GRCh38_ERCC_combined.gtf'
    
    // Resource limits (will be overridden by profiles)
    max_cpus                  = 8
    max_memory                = '256.GB'
    max_time                  = '24.h'
    
    // AWS configuration
    aws_region                = 'us-east-2'  // Update as needed
}

// Process configuration
process {
    // Default container (pinned version for reproducibility)
    container = 'nfcore/rnaseq:3.15.0'
    
    // Default executor (overridden by profiles)
    executor = 'local'
}

// Container configuration
singularity {
    enabled = true
    autoMounts = true
    cacheDir = './singularity_cache'
}

docker {
    enabled = false  // Set to true if using Docker instead
}

// AWS configuration
aws {
    region = params.aws_region
    batch {
        cliPath = '/usr/local/aws-cli/v2/current/bin/aws'
    }
}

// Workflow configuration
workflow {
    // Enable resume by default
    resume = true
}

// Profiles for different execution environments
profiles {
    local {
        includeConfig 'conf/local.config'
    }
    
    aws {
        includeConfig 'conf/aws.config'
    }
    
    test {
        includeConfig 'conf/test.config'
    }
}

// Reporting configuration
report {
    enabled = true
    file = "${params.outdir}/pipeline_info/execution_report.html"
}

timeline {
    enabled = true
    file = "${params.outdir}/pipeline_info/execution_timeline.html"
}

trace {
    enabled = true
    file = "${params.outdir}/pipeline_info/execution_trace.txt"
}

dag {
    enabled = true
    file = "${params.outdir}/pipeline_info/pipeline_dag.html"
}

manifest {
    name = 'ERCC RNA-seq Analysis'
    author = 'Your Name'
    description = 'nf-core/rnaseq pipeline with ERCC spike-ins'
    version = '1.0.0'
    nextflowVersion = '>=23.04.0'
}